/*! skrollr v0.5.0-alpha https://github.com/Prinzhorn/skrollr | free to use under terms of MIT license */

(function(e,t,n){"use strict";function F(n){tt=this,n=n||{},ft=n.constants||{};if(n.easing)for(var r in n.easing)j[r]=n.easing[r];it={beforerender:n.beforerender,render:n.render},st=n.forceHeight!==!1,dt=n.smoothScrolling!==!1,vt={targetTop:tt.getScrollTop()},st&&(at=n.scale||1),Q(i,[f],[l]);if(st){var o=t.getElementById("skrollr-body")||t.createElement("div"),u=o.style;u.minWidth="1px",u.position="absolute",u.top=u.zIndex="0",o.id||(u.width="1px",u.right="0",s.appendChild(o)),ut=function(){ot=0,I(),u.height=ot+i.clientHeight+"px",yt.iscroll&&e.setTimeout(function(){yt.iscroll.refresh()},0)}}else ut=function(){ot=s.scrollHeight-i.clientHeight,I(),mt=!0,yt.iscroll&&e.setTimeout(function(){yt.iscroll.refresh()},0)};return tt.refresh(),K("resize",ut),function a(){E(a),R()}(),tt}var r=Object.prototype.hasOwnProperty,i=t.documentElement,s=t.body,o="rendered",u="un"+o,a="skrollable",f="skrollr",l="no-"+f,c="linear",h=1e3,p=200,d="start",v="end",m="top",g="center",y="bottom",b="___has_rendered_class",w="___skrollable_id",E=e.requestAnimationFrame;(function(){var t=["ms","moz","webkit","o"],n;for(n=0;n<t.length&&!E;n++)E=e[t[n]+"RequestAnimationFrame"];var r=0;E||(E=function(t){var n=Z(),i=Math.max(0,30-(n-r));e.setTimeout(function(){t(n+i)},i),r=n+i})})();var S=/^\s*(.+)\s*$/m,x=/^data(?:-(_\w+))?(?:-?(-?\d+))?(?:-?(start|end|top|center|bottom))?(?:-?(top|center|bottom))?$/,T=/\s*([a-z\-\[\]]+)\s*:\s*(.+?)\s*;/gi,N=/^([a-z\-]+)\[(\w+)\]$/,C=/-([a-z])/g,k=function(e,t){return t.toUpperCase()},L=/[\-+]?[\d]*\.?[\d]+/g,A=/\{\?\}/g,O=/rgba?\(\s*-?\d+\s*,\s*-?\d+\s*,\s*-?\d+/g,M=/[a-z\-]+-gradient/g,_=/^O|Moz|webkit|ms/,D,P;if(e.getComputedStyle){var H=e.getComputedStyle(s,null);for(var B in H){D=B.match(_)||+B==B&&H[B].match(_);if(D)break}}D=(D||[""])[0],P="-"+D.toLowerCase()+"-",_=n;var j={begin:function(){return 0},end:function(){return 1},linear:function(e){return e},quadratic:function(e){return e*e},cubic:function(e){return e*e*e},swing:function(e){return-Math.cos(e*Math.PI)/2+.5},sqrt:function(e){return Math.sqrt(e)},bounce:function(e){var t;if(e<=.5083)t=3;else if(e<=.8489)t=9;else if(e<=.96208)t=27;else{if(!(e<=.99981))return 1;t=91}return 1-Math.abs(3*Math.cos(e*t*1.028)/t)}};F.prototype.refresh=function(e){var r,i=!1;e===n?(i=!0,rt=[],gt=0,e=t.getElementsByTagName("*")):e=[].concat(e);for(r=0;r<e.length;r++){var s=e[r],f=s,l=[],c=dt;if(!s.attributes)continue;for(var h=0;h<s.attributes.length;h++){var p=s.attributes[h];if(p.name==="data-anchor-target"){f=t.querySelector(p.value);if(f===null)throw'Unable to find anchor target "'+p.value+'"';continue}if(p.name==="data-smooth-scrolling"){c=p.value!=="off";continue}var m=p.name.match(x);if(m!==null){var g=m[1];g=g&&ft[g.substr(1)]||0;var y=(m[2]|0)+g,b=m[3],E=m[4]||b,S={offset:y,props:p.value,element:s};l.push(S),!b||b===d||b===v?(S.mode="absolute",b===v?S.isEnd=!0:(S.frame=y*at,delete S.offset)):(S.mode="relative",S.anchors=[b,E])}}if(l.length){var T;!i&&w in s?T=s[w]:T=s[w]=gt++,rt[T]={element:s,anchorTarget:f,keyFrames:l,smoothScrolling:c},Q(s,[a,u],[o])}}ut();for(r=0;r<e.length;r++){var N=rt[e[r][w]];if(N===n)continue;N.keyFrames.sort(et),U(N),W(N)}return tt},F.prototype.relativeToAbsolute=function(e,t,n){var r=i.clientHeight,s=e.getBoundingClientRect(),o=s.top;return t===y?o-=r:t===g&&(o-=r/2),n===y?o+=s.height:n===g&&(o+=s.height/2),o+=tt.getScrollTop(),o+.5|0},F.prototype.animateTo=function(e,t){t=t||{};var r=Z(),i=tt.getScrollTop();return pt={startTop:i,topDiff:e-i,targetTop:e,duration:t.duration||h,startTime:r,endTime:r+(t.duration||h),easing:j[t.easing||c],done:t.done},pt.topDiff||(pt.done&&pt.done.call(tt,!1),pt=n),tt},F.prototype.stopAnimateTo=function(){pt&&pt.done&&pt.done.call(tt,!0),pt=n},F.prototype.isAnimatingTo=function(){return!!pt},F.prototype.setScrollTop=function(t){return(yt.iscroll||e).scrollTo(0,t),tt},F.prototype.getScrollTop=function(){return yt.iscroll?-yt.iscroll.y:e.pageYOffset||i.scrollTop||s.scrollTop||0},F.prototype.on=function(e,t){return it[e]=t,tt},F.prototype.off=function(e){return delete it[e],tt};var I=function(){var e,t,n,r,i,s;for(i=0;i<rt.length;i++){e=rt[i],t=e.anchorTarget,n=e.keyFrames;for(s=0;s<n.length;s++)r=n[s],r.mode==="relative"&&(r.frame=tt.relativeToAbsolute(t,r.anchors[0],r.anchors[1])-r.offset),st&&!r.isEnd&&r.frame>ot&&(ot=r.frame)}for(i=0;i<rt.length;i++){e=rt[i],n=e.keyFrames;for(s=0;s<n.length;s++)r=n[s],r.isEnd&&(r.frame=ot-r.offset)}},q=function(e,t){for(var n=0;n<rt.length;n++){var i=rt[n],s=i.smoothScrolling?e:t,a=i.keyFrames,f=a[0].frame,l=a[a.length-1].frame,c=s<=f,h=s>=l,p,d;if(c||h){var v=a[c?0:a.length-1].props;for(p in v)r.call(v,p)&&(d=$(v[p].value),J(i.element,p,d));i[b]&&(s<f||s>l)&&(Q(i.element,[u],[o]),i[b]=!1);continue}i[b]||(Q(i.element,[o],[u]),i[b]=!0);for(var m=0;m<a.length-1;m++)if(s>=a[m].frame&&s<=a[m+1].frame){var g=a[m],y=a[m+1];for(p in g.props)if(r.call(g.props,p)){var w=(s-g.frame)/(y.frame-g.frame);w=g.props[p].easing(w),d=V(g.props[p].value,y.props[p].value,w),d=$(d),J(i.element,p,d)}break}}},R=function(){var e=tt.getScrollTop(),t,r=Z(),i;if(pt)r>=pt.endTime?(e=pt.targetTop,t=pt.done,pt=n):(i=pt.easing((r-pt.startTime)/pt.duration),e=pt.startTop+i*pt.topDiff|0),tt.setScrollTop(e);else{var s=vt.targetTop-e;s&&(vt={startTop:ct,topDiff:e-ct,targetTop:e,startTime:ht,endTime:ht+p}),r<=vt.endTime&&(i=j.sqrt((r-vt.startTime)/p),e=vt.startTop+i*vt.topDiff|0)}e<0&&(e=0);if(mt||ct!==e){lt=e>=ct?"down":"up",mt=!1;var o={curTop:e,lastTop:ct,maxTop:ot,direction:lt},u=it.beforerender&&it.beforerender.call(tt,o);u!==!1&&(q(e,tt.getScrollTop()),ct=e,it.render&&it.render.call(tt,o)),t&&t.call(tt,!1)}ht=r},U=function(e){for(var t=0;t<e.keyFrames.length;t++){var n=e.keyFrames[t],r,i,s,o={},u;while((u=T.exec(n.props))!==null)s=u[1],i=u[2],r=s.match(N),r!==null?(s=r[1],r=r[2]):r=c,i=i.indexOf("!")?z(i):[i.slice(1)],o[s]={value:i,easing:j[r]};n.props=o}},z=function(e){var t=[];return O.lastIndex=0,e=e.replace(O,function(e){return e.replace(L,function(e){return e/255*100+"%"})}),M.lastIndex=0,e=e.replace(M,function(e){return P+e}),e=e.replace(L,function(e){return t.push(+e),"{?}"}),t.unshift(e),t},W=function(e){var t={},n;for(n=0;n<e.keyFrames.length;n++)X(e.keyFrames[n],t);t={};for(n=e.keyFrames.length-1;n>=0;n--)X(e.keyFrames[n],t)},X=function(e,t){var n;for(n in t)r.call(e.props,n)||(e.props[n]=t[n]);for(n in e.props)t[n]=e.props[n]},V=function(e,t,n){if(e.length!==t.length)throw"Can't interpolate between \""+e[0]+'" and "'+t[0]+'"';var r=[e[0]];for(var i=1;i<e.length;i++)r[i]=e[i]+(t[i]-e[i])*n;return r},$=function(e){var t=1;return A.lastIndex=0,e[0].replace(A,function(){return e[t++]})},J=function(e,t,n){var r=e.style;t=t.replace(C,k).replace("-","");if(t==="zIndex")r[t]=""+(n|0);else if(t==="float")r.styleFloat=r.cssFloat=n;else try{r[D+t.slice(0,1).toUpperCase()+t.slice(1)]=n,r[t]=n}catch(i){}if(nt.setStyle)for(var s=0;s<nt.setStyle.length;s++)nt.setStyle[s].call(tt,e,t,n)},K=function(t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},Q=function(t,n,r){var i="className";e.SVGElement&&t instanceof e.SVGElement&&(t=t[i],i="baseVal");var s=t[i];for(var o=0;o<n.length;o++)Y(s).indexOf(Y(n[o]))===-1&&(s+=" "+n[o]);for(var u=0;u<r.length;u++)s=Y(s).replace(Y(r[u])," ");t[i]=G(s)},G=function(e){return e.replace(S,"$1")},Y=function(e){return" "+e+" "},Z=Date.now||function(){return+(new Date)},et=function(e,t){return e.frame-t.frame},tt,nt={},rt=[],it,st,ot=0,ut,at=1,ft,lt="down",ct=-1,ht=Z(),pt,dt,vt,mt,gt=0,yt=e.skrollr={get:function(){return tt},init:function(e){return tt||new F(e)},plugin:function(e,t){nt[e]?nt[e].push(t):nt[e]=[t]},VERSION:"0.5.0-alpha"}})(window,document);